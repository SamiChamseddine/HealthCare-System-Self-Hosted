<Page x:Class="Florence.Desktop.Views.PatientForm"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mah="http://metro.mahapps.com/winfx/xaml/controls"
      xmlns:utils="clr-namespace:Florence.Desktop.Utils"
      xmlns:controls="clr-namespace:Florence.Desktop.Controls"
      Title="Create Patient"
      Focusable="True"
      FocusManager.IsFocusScope="True"
      Background="{DynamicResource MahApps.Brushes.ThemeBackground}">

    <Page.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        <utils:DateOnlyConverter x:Key="DateOnlyConverter"/>
    </Page.Resources>

    <Grid Margin="30" Background="Transparent" MouseDown="Grid_MouseDown">
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <ScrollViewer Grid.Row="0" VerticalScrollBarVisibility="Auto" PanningMode="Both" Focusable="False">
            <StackPanel Margin="0,0,0,20">

                <Grid Margin="0,0,0,20">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <controls:BackToDashboardButton 
        Grid.Column="0"
        Margin="0,0,20,0"
        VerticalAlignment="Center"/>

                    <TextBlock Text="Create Patient"
               Grid.Column="1"
               FontSize="22"
               FontWeight="Bold"
               Foreground="{DynamicResource MahApps.Brushes.Text}"
               VerticalAlignment="Center"/>
                </Grid>


                <Border Background="{DynamicResource MahApps.Brushes.Control.Background2}"
                        BorderBrush="{DynamicResource MahApps.Brushes.Control.Border}"
                        BorderThickness="1"
                        Padding="15" Margin="0,0,0,15">
                    <Grid Margin="0,0,0,8">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="2*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <StackPanel Grid.Row="0" Grid.Column="0" Margin="4">
                            <TextBlock Text="Full Name *" Style="{StaticResource FormLabel}"/>
                            <TextBox Text="{Binding Patient.FullName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                     Style="{StaticResource FormTextBox}"/>
                        </StackPanel>

                        <StackPanel Grid.Row="0" Grid.Column="1" Margin="4">
                            <TextBlock Text="Date of Birth *" Style="{StaticResource FormLabel}"/>
                            <DatePicker SelectedDate="{Binding Patient.DateOfBirth, Converter={StaticResource DateOnlyConverter}, Mode=TwoWay}"
                                        Style="{StaticResource FormDatePicker}"/>
                        </StackPanel>

                        <StackPanel Grid.Row="0" Grid.Column="2" Margin="4">
                            <TextBlock Text="Gender *" Style="{StaticResource FormLabel}"/>
                            <ComboBox ItemsSource="{Binding Genders}"
                                      SelectedItem="{Binding Patient.Gender, Mode=TwoWay}"
                                      Style="{StaticResource FormComboBox}"/>
                        </StackPanel>

                        <StackPanel Grid.Row="1" Grid.ColumnSpan="3" Margin="4,10,4,0">
                            <TextBlock Text="Address" Style="{StaticResource FormLabel}"/>
                            <TextBox Text="{Binding Patient.Address}" AcceptsReturn="True"
                                     Height="60" TextWrapping="Wrap"
                                     Style="{StaticResource FormTextBox}"/>
                        </StackPanel>

                        <StackPanel Grid.Row="2" Grid.ColumnSpan="3" Margin="4,10,4,0">
                            <TextBlock Text="Phone Number *" Style="{StaticResource FormLabel}"/>
                            <TextBox Text="{Binding Patient.PhoneNumber}" Style="{StaticResource FormTextBox}"/>
                        </StackPanel>
                    </Grid>
                </Border>

                <Border Background="{DynamicResource MahApps.Brushes.Control.Background2}"
                        BorderBrush="{DynamicResource MahApps.Brushes.Control.Border}"
                        BorderThickness="1"
                        Padding="15" Margin="0,0,0,15">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <StackPanel Grid.Column="0" Margin="4">
                            <TextBlock Text="Emergency Contact" Style="{StaticResource FormLabel}"/>
                            <TextBox Text="{Binding Patient.EmergencyContact}" Style="{StaticResource FormTextBox}"/>
                        </StackPanel>
                        <StackPanel Grid.Column="1" Margin="4">
                            <TextBlock Text="Relationship" Style="{StaticResource FormLabel}"/>
                            <TextBox Text="{Binding Patient.EmergencyRelationship}" Style="{StaticResource FormTextBox}"/>
                        </StackPanel>
                        <StackPanel Grid.Column="2" Margin="4">
                            <TextBlock Text="Emergency Phone" Style="{StaticResource FormLabel}"/>
                            <TextBox Text="{Binding Patient.EmergencyPhone}" Style="{StaticResource FormTextBox}"/>
                        </StackPanel>
                    </Grid>
                </Border>

                <Border Background="{DynamicResource MahApps.Brushes.Control.Background2}"
                        BorderBrush="{DynamicResource MahApps.Brushes.Control.Border}"
                        BorderThickness="1"
                        Padding="15" Margin="0,0,0,15">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <StackPanel Grid.Column="0" Margin="4">
                            <TextBlock Text="Insurance Provider" Style="{StaticResource FormLabel}"/>
                            <TextBox Text="{Binding Patient.InsuranceProvider}" Style="{StaticResource FormTextBox}"/>
                        </StackPanel>
                        <StackPanel Grid.Column="1" Margin="4">
                            <TextBlock Text="Policy Number" Style="{StaticResource FormLabel}"/>
                            <TextBox Text="{Binding Patient.PolicyNumber}" Style="{StaticResource FormTextBox}"/>
                        </StackPanel>
                    </Grid>
                </Border>

                <Border Background="{DynamicResource MahApps.Brushes.Control.Background2}"
                        BorderBrush="{DynamicResource MahApps.Brushes.Control.Border}"
                        BorderThickness="1" Padding="15" Margin="0,0,0,15">
                    <StackPanel>
                        <TextBlock Text="Medical Conditions" FontWeight="SemiBold" Style="{StaticResource FormLabel}" Margin="0,0,0,6"/>
                        <DockPanel>
                            <TextBox Text="{Binding NewMedicalCondition, UpdateSourceTrigger=PropertyChanged}"
         Width="280" Style="{StaticResource FormTextBox}"/>
                            <Button Content="+ Add"
        Command="{Binding AddMedicalConditionCommand}"
        Margin="6,0,0,0"
        Style="{StaticResource PrimaryButton}"/>

                        </DockPanel>
                        <Border BorderBrush="{DynamicResource MahApps.Brushes.Control.Border}" BorderThickness="1"
                                Background="{DynamicResource MahApps.Brushes.Control.Background}" Margin="0,4,0,0">
                            <ListBox ItemsSource="{Binding MedicalConditions}">
                                <ListBox.ItemTemplate>
                                    <DataTemplate>
                                        <DockPanel LastChildFill="False" Margin="4">
                                            <TextBlock Text="{Binding}" DockPanel.Dock="Left" VerticalAlignment="Center"/>
                                            <Button Content="Remove"
                                                    Command="{Binding DataContext.RemoveMedicalConditionCommand, RelativeSource={RelativeSource AncestorType=Page}}"
                                                    CommandParameter="{Binding}"
                                                    DockPanel.Dock="Right" Style="{StaticResource DangerButton}"/>
                                        </DockPanel>
                                    </DataTemplate>
                                </ListBox.ItemTemplate>
                            </ListBox>
                        </Border>

                        <TextBlock Text="Current Medications" Margin="0,10,0,0" Style="{StaticResource FormLabel}" FontWeight="SemiBold"/>
                        <TextBox Text="{Binding Patient.CurrentMedications}" AcceptsReturn="True" Height="60"
                                 TextWrapping="Wrap" Style="{StaticResource FormTextBox}"/>

                        <TextBlock Text="Surgeries" Margin="0,10,0,0" Style="{StaticResource FormLabel}" FontWeight="SemiBold"/>
                        <TextBox Text="{Binding Patient.Surgeries}" AcceptsReturn="True" Height="60"
                                 TextWrapping="Wrap" Style="{StaticResource FormTextBox}"/>

                        <TextBlock Text="Allergies" Margin="0,10,0,0" Style="{StaticResource FormLabel}" FontWeight="SemiBold"/>
                        <TextBox Text="{Binding Patient.Allergies}" AcceptsReturn="True" Height="60"
                                 TextWrapping="Wrap" Style="{StaticResource FormTextBox}"/>

                        <TextBlock Text="Family History" Style="{StaticResource FormLabel}" Margin="0,10,0,6" FontWeight="SemiBold"/>
                        <DockPanel>
                            <TextBox Text="{Binding NewFamilyHistoryEntry, UpdateSourceTrigger=PropertyChanged}"
         Width="400" Style="{StaticResource FormTextBox}"/>
                            <Button Content="+ Add"
        Command="{Binding AddFamilyHistoryCommand}"
        Margin="6,0,0,0"
        Style="{StaticResource PrimaryButton}"/>

                        </DockPanel>
                        <Border BorderBrush="{DynamicResource MahApps.Brushes.Control.Border}" BorderThickness="1"
                                Background="{DynamicResource MahApps.Brushes.Control.Background}" Margin="0,4,0,0">
                            <ListBox ItemsSource="{Binding FamilyHistory}">
                                <ListBox.ItemTemplate>
                                    <DataTemplate>
                                        <DockPanel LastChildFill="False" Margin="4">
                                            <TextBlock Text="{Binding}" DockPanel.Dock="Left" VerticalAlignment="Center"/>
                                            <Button Content="Remove"
                                                    Command="{Binding DataContext.RemoveFamilyHistoryCommand, RelativeSource={RelativeSource AncestorType=Page}}"
                                                    CommandParameter="{Binding}"
                                                    DockPanel.Dock="Right" Style="{StaticResource DangerButton}"/>
                                        </DockPanel>
                                    </DataTemplate>
                                </ListBox.ItemTemplate>
                            </ListBox>
                        </Border>
                    </StackPanel>
                </Border>

                <Border Background="{DynamicResource MahApps.Brushes.Control.Background2}"
                        BorderBrush="{DynamicResource MahApps.Brushes.Control.Border}"
                        BorderThickness="1" Padding="15" Margin="0,0,0,15">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <StackPanel Grid.Column="0" Grid.Row="0" Margin="4">
                            <TextBlock Text="Preferred Language" Style="{StaticResource FormLabel}"/>
                            <TextBox Text="{Binding Patient.PreferredLanguage}" Style="{StaticResource FormTextBox}"/>
                        </StackPanel>

                        <StackPanel Grid.Column="1" Grid.Row="0" Margin="4">
                            <TextBlock Text="Interpreter Needed" Style="{StaticResource FormLabel}"/>
                            <CheckBox IsChecked="{Binding Patient.InterpreterNeeded, Mode=TwoWay}"/>
                        </StackPanel>

                        <StackPanel Grid.Column="2" Grid.Row="0" Margin="4">
                            <TextBlock Text="Created By" Style="{StaticResource FormLabel}"/>
                            <TextBox Text="{Binding Patient.CreatedBy}" Style="{StaticResource FormTextBox}"/>
                        </StackPanel>

                        <StackPanel Grid.Column="0" Grid.Row="1" Margin="4">
                            <TextBlock Text="Primary Care Physician" Style="{StaticResource FormLabel}"/>
                            <TextBox Text="{Binding Patient.PrimaryCarePhysician}" Style="{StaticResource FormTextBox}"/>
                        </StackPanel>

                        <StackPanel Grid.Column="1" Grid.Row="1" Margin="4">
                            <TextBlock Text="Physician Phone" Style="{StaticResource FormLabel}"/>
                            <TextBox Text="{Binding Patient.PhysicianPhone}" Style="{StaticResource FormTextBox}"/>
                        </StackPanel>

                        <StackPanel Grid.Column="0" Grid.Row="2" Margin="4">
                            <TextBlock Text="Vaccinations" Style="{StaticResource FormLabel}"/>
                            <TextBox Text="{Binding Patient.Vaccinations}" AcceptsReturn="True" Height="60"
                                     TextWrapping="Wrap" Style="{StaticResource FormTextBox}"/>
                        </StackPanel>

                        <StackPanel Grid.Column="1" Grid.Row="2" Margin="4">
                            <TextBlock Text="Current Pain" Style="{StaticResource FormLabel}"/>
                            <TextBox Text="{Binding Patient.CurrentPain}" AcceptsReturn="True" Height="60"
                                     TextWrapping="Wrap" Style="{StaticResource FormTextBox}"/>
                        </StackPanel>

                        <StackPanel Grid.Column="2" Grid.Row="2" Margin="4">
                            <TextBlock Text="Gynecological History" Style="{StaticResource FormLabel}"/>
                            <TextBox Text="{Binding Patient.GynecologicalHistory}" AcceptsReturn="True" Height="60"
                                     TextWrapping="Wrap" Style="{StaticResource FormTextBox}"/>
                        </StackPanel>

                        <StackPanel Grid.ColumnSpan="3" Grid.Row="3" Margin="4">
                            <TextBlock Text="Mental Health Issues" Style="{StaticResource FormLabel}"/>
                            <TextBox Text="{Binding Patient.MentalHealthIssues}" AcceptsReturn="True" Height="60"
                                     TextWrapping="Wrap" Style="{StaticResource FormTextBox}"/>
                        </StackPanel>
                    </Grid>
                </Border>

                <TextBlock Text="{Binding Error}"
                           Foreground="#E57373"
                           FontWeight="SemiBold"
                           Visibility="{Binding HasErrors, Converter={StaticResource BooleanToVisibilityConverter}}"/>
            </StackPanel>
        </ScrollViewer>

        <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,20,0,0">
            <Button Content="Save" Command="{Binding SaveCommand}" Style="{StaticResource PrimaryButton}" Margin="0,0,10,0"/>
            <Button Content="Clear" Command="{Binding ClearCommand}" Style="{StaticResource SecondaryButton}"/>
        </StackPanel>
    </Grid>
</Page>
